import{d as m,f as a,ha as g,i as s,l as c,o as d,oa as k,r as u}from"./chunk-G4DRSHJR.js";var r=class{constructor(o,T,t,e){this.email=o,this.id=T,this._token=t,this._tokenExpirationDate=e}get token(){return!this._tokenExpirationDate||new Date>this._tokenExpirationDate?null:this._token}};var p={production:!1,apiKey:"AIzaSyAyvR2zjG7R3hYavZV6TcFXXi3dy0Fbu9g"};var L=(()=>{let o=class o{constructor(t,e){this.http=t,this.router=e,this.user=new m(null)}signup(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key="+p.apiKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),c(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}login(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key="+p.apiKey,{email:t,password:e,returnSecureToken:!0}).pipe(s(this.handleError),c(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}autoLogin(){let t=JSON.parse(localStorage.getItem("userDataRecipe"));if(!t)return;let e=new r(t.email,t.id,t._token,new Date(t._tokenExpirationDate));if(e.token){let i=new Date(t._tokenExpirationDate).getTime()-new Date().getTime();this.user.next(e),this.autoLogout(i)}}logout(){this.user.next(null),this.router.navigate(["/auth"]),localStorage.removeItem("userDataRecipe"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer),this.tokenExpirationTimer=null}autoLogout(t){this.tokenExpirationTimer=setTimeout(()=>{this.logout()},t)}handleAuthentication(t,e,i,h){let f=new Date(new Date().getTime()+h*1e3),l=new r(t,e,i,f);this.user.next(l),this.autoLogout(h*1e3),localStorage.setItem("userDataRecipe",JSON.stringify(l))}handleError(t){console.log(t);let e=" An unknown error occurred!";if(!t.error||!t.error.error)a(e);else{switch(t.error.error.message){case"EMAIL_EXISTS":e="This email exists already";break;case"EMAIL_NOT_FOUND":e="This email does not exist";break;case"INVALID_PASSWORD":e="This password is not correct";break;case"INVALID_LOGIN_CREDENTIALS":e="There is an error in the email or password";break}return a(e)}}};o.\u0275fac=function(e){return new(e||o)(u(g),u(k))},o.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();export{L as a};
